<!doctype html>
<html lang="zh-Hant">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>簡易計算機</title>
<style>
  :root { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial; }
  body { margin: 0; background: #111; color: #fff; display: grid; place-items: center; height: 100svh; }
  .app { width: min(420px, 94vw); display: grid; gap: 10px; }
  .screen { background:#000; padding: 18px; border-radius: 16px; font-size: 42px; text-align: right; overflow:auto }
  .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
  button { padding:18px; font-size:22px; border:none; border-radius:16px; background:#2a2a2a; color:#fff; }
  button.op { background:#ff9f0a; }
  button.eq { background:#34c759; grid-column: span 2; }
  button.wide { grid-column: span 2; }
</style>
<div class="app">
  <div id="screen" class="screen">0</div>
  <div class="grid">
    <button data-k="C">C</button>
    <button data-k="⌫">⌫</button>
    <button data-k="(">(</button>
    <button class="op" data-k="/">÷</button>

    <button data-k="7">7</button>
    <button data-k="8">8</button>
    <button data-k="9">9</button>
    <button class="op" data-k="*">×</button>

    <button data-k="4">4</button>
    <button data-k="5">5</button>
    <button data-k="6">6</button>
    <button class="op" data-k="-">−</button>

    <button data-k="1">1</button>
    <button data-k="2">2</button>
    <button data-k="3">3</button>
    <button class="op" data-k="+">+</button>

    <button class="wide" data-k="0">0</button>
    <button data-k=".">.</button>
    <button class="eq" data-k="=">=</button>
  </div>
</div>
<script>
  const s = document.getElementById('screen');
  let expr = '0';
  const render = () => s.textContent = expr;
  const safeEval = (e) => {
    // 只允許數字/運算符/小數點/括號
    if (!/^[\d+\-*/().\s]+$/.test(e)) throw new Error('Invalid');
    // 使用 Function 而非 eval，仍請保持輸入限制
    return Function(`"use strict";return(${e})`)();
  };
  addEventListener('click', e => {
    const k = e.target?.dataset?.k; if (!k) return;
    if (k === 'C') { expr = '0'; return render(); }
    if (k === '⌫') { expr = expr.length>1? expr.slice(0,-1):'0'; return render(); }
    if (k === '=') {
      try { expr = String(safeEval(expr)); } catch { expr = '錯誤'; setTimeout(()=>{expr='0';render();},700); return render(); }
      return render();
    }
    expr = (expr === '0' && /\d|\./.test(k)) ? k : expr + k;
    render();
  });
  // 鍵盤支援
  addEventListener('keydown', e=>{
    const map = {Enter:'=',Backspace:'⌫','*':'*','/':'/','+':'+','-':'-','(':'(',')':')','.' :'.'};
    if ((e.key>='0'&&e.key<='9') || map[e.key]) {
      e.preventDefault();
      document.querySelector(`[data-k="${map[e.key]||e.key}"]`)?.click();
    } else if (e.key==='Escape'){ document.querySelector('[data-k="C"]').click(); }
  });
</script>
</html>
